@model HarmonicPatternsBase.Models.HarmonicPatternViewModels.HarmonicPatternIndexViewModel

@{
    ViewData["Title"] = "Index";
    Random r = new Random();
}


<div style="background-color:#36424a">
    <div class="container" style="padding:20px;">

        <div class="dropdown" style="display:inline-block;">
            <button class="btn button-purple dropdown-toggle button-nav" type="button" id="dropdownMenu"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">

                @if (Model.SelectedInstrument == null)
                {
                    <span>Instrument</span>
                }
                else
                {
                    @Model.SelectedInstrument.Name
                }

                <span class="caret"></span>
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu">

                <li>
                    <a asp-action="Index"
                       asp-route-intervalid="@Model.SelectedIntervalId" 
                       asp-route-patterntypeid="@Model.SelectedPatternId"
                       asp-route-instrumentid="@null">
                    Wszystkie instrumenty</a>
                </li>

                <li class="divider"></li>

                @foreach (var item in Model.Instruments)
                {
                    <li>
                        <a asp-action="Index" 
                           asp-route-intervalid="@Model.SelectedIntervalId" 
                           asp-route-patterntypeid="@Model.SelectedPatternId"
                           asp-route-instrumentid="@item.Id">
                        @item.Name</a>
                    </li>
                }
            </ul>
        </div>

            <div class="dropdown" style="display:inline-block;">
                <button class="btn button-blue dropdown-toggle button-nav" type="button" id="dropdownMenu"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">

                    @if (Model.SelectedPattern == null)
                    {
                        <span>Uklad</span>
                    }
                    else
                    {
                        @Model.SelectedPattern.Name
                    }

                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu">

                    <li>
                        <a asp-action="Index" 
                           asp-route-intervalid="@Model.SelectedIntervalId" 
                           asp-route-instrumentid="@Model.SelectedInstrumentId"
                           asp-route-patterntypeid="@null">
                        Wszystkie uklady</a>
                    </li>

                    <li class="divider"></li>

                    @foreach (var item in Model.PatternTypes)
                    {
                        <li>
                            <a asp-action="Index" 
                               asp-route-intervalid="@Model.SelectedIntervalId" 
                               asp-route-instrumentid="@Model.SelectedInstrumentId"
                               asp-route-patterntypeid="@item.Id">
                            @item.Name</a>
                        </li>
                    }
                </ul>
            </div>

            <div class="dropdown" style="display:inline-block;">
                <button class="btn button-green dropdown-toggle button-nav"  type="button" id="dropdownMenu"
                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">

                    @if (Model.SelectedInterval == null)
                    {
                        <span>Interwal</span>
                    }
                    else
                    {
                        @Model.SelectedInterval.Value
                    }

                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu">

                    <li>
                        <a asp-action="Index" 
                           asp-route-patterntypeid="@Model.SelectedPatternId"
                           asp-route-instrumentid="@Model.SelectedInstrumentId" 
                           asp-route-intervalid="@null">
                        Wszystkie interwaly</a>
                    </li>

                    <li class="divider"></li>

                    @foreach(var item in Model.Intervals)
                    {
                        <li>
                            <a asp-action="Index" 
                               asp-route-patterntypeid="@Model.SelectedPatternId" 
                               asp-route-instrumentid="@Model.SelectedInstrumentId"
                               asp-route-intervalid="@item.Id">
                            @item.Value</a>
                        </li>
                    }
                </ul>
            </div>

        <div class="navbar-right" style="display:inline-block;">
            <a asp-area="" asp-controller="HarmonicPatterns" asp-action="Create" class="btn button-navframe">Dodaj</a>
        </div>

    </div> 
</div>


    <div style="height:200px; padding:30px; background-color:#d6d9dc">

        <div class="text text-blue container">
            <div class="col-md-6">
                <p>
                    <span style="color:#920063"> @Model.HarmonicPatterns.Count </span>
                    ukladow
                    @if (Model.SelectedInstrumentId != null)
                    {
                        <span><a asp-action="Edit" class="btn button-purple">@Model.SelectedInstrument.Name</a></span>
                    }
                    @if (Model.SelectedPatternId != null)
                    {
                        <a asp-controller="Patterns" asp-action="Details" asp-route-id="@Model.SelectedPattern.Id" class="btn button-blue">@Model.SelectedPattern.Name</a>
                    }
                    @if (Model.SelectedIntervalId != null)
                    {
                        <a asp-action="Edit" class="btn button-green">@Model.SelectedInterval.Value</a>
                    }

                    w bazie danych
                </p>

                @{
                    double avarageReaction = 0;
                    double avaragePrecision = 0;

                    foreach (var item in Model.HarmonicPatterns)
                    {
                        avaragePrecision += item.AvaragePrecisionRating;
                        avarageReaction += item.AvarageReactionRating;
                    }

                    avaragePrecision = avaragePrecision / Model.HarmonicPatterns.Count;
                    avarageReaction = avarageReaction / Model.HarmonicPatterns.Count;
                }

                <p>
                    <span style="color:#920063"> @avarageReaction.ToString("#.##") </span>
                    srednia ocena reakcji ukladu
                </p>
                <p>
                    <span style="color:#920063"> @avaragePrecision.ToString("#.##") </span>
                    srednia ocena precyzji ukladu
                </p>
                <p>
                    <a asp-action="Edit" class="btn button-blueframe">Wiecej statystyk</a>
                </p>
            </div>

            <div class="col-md-6">
               
            </div>

        </div>
    </div>


<div class="container" style="margin-top:30px">

    

    <div class="masonry">

        @foreach (var item in Model.HarmonicPatterns)
        {
            string imageContent = "";

            var i = r.Next(0, 5);
            if(i == 0)
            {
                imageContent = "~/images/patterns/uklad1.png";
            }
            else if (i == 1)
            {
                imageContent = "~/images/patterns/uklad2.png";
            }
            else if (i == 2)
            {
                imageContent = "~/images/patterns/uklad3.png";
            }
            else if (i == 3)
            {
                imageContent = "~/images/patterns/uklad4.png";
            }
            else
            {
                imageContent = "~/images/patterns/uklad5.png";
            }

            <div class="item">

                @if (item.Image.Length > 5)
                {
                    var base64 = Convert.ToBase64String(item.Image);
                    imageContent = String.Format("data:image/gif;base64,{0}", base64);
                }

                <div style="margin-bottom:10px;">
                    <a asp-action="Edit" class="btn button-purple">@item.Instrument.Name</a>
                    <a asp-action="Edit" class="btn button-green">@item.Interval.Value</a>
                    <a asp-controller="Patterns" asp-action="Details" asp-route-id="@item.PatternType.Id" class="btn button-blue">@item.PatternType.Name</a>
                </div>

                <div style="margin-bottom:10px;">
                    @if(item.User == null)
                    {
                       <img src='~/images/DefaultUserPhoto.png' class="img-circle" style="height:50px; width:50px; display:inline-block;" />
                    }
                    else
                    {

                    }

                        @if (item.User == null)
                        {
                            <a asp-action="Edit" class="text text-blue" style="margin-left:5px; display:inline-block; font-size:12px;">NIEZNANY UZYTKOWNIK</a>
                        }
                        else
                        {

                        }
                   
                     
                </div>

                <a asp-action="Details" asp-route-id="@item.Id">
                    <div style="text-align:center">
                        <img src='@imageContent' class="img-rounded" style="max-width:230px;" asp-append-version="true" />
                    </div>
                </a>

                <div class="text row" style="margin-top:10px; font-size:12px;">
                    <div class="col-md-5">
                        <p>
                            NA RYNKU:
                        </p>
                        <p>
                            DODANO:
                        </p>
                    </div>
                    <div>
                        <p>
                            <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>
                            @Html.DisplayFor(modelItem => item.Date)
                        </p>
                        <p>
                            <span class="glyphicon glyphicon-calendar" aria-hidden="true"></span>
                            @Html.DisplayFor(modelItem => item.AddDate)
                        </p>
                    </div>

                </div>

            </div>
        }
    </div>
</div>
